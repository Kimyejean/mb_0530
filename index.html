<div>Teachable Machine Image Model</div>

<button type="button" onclick="init()">Start</button>

<div id="webcam-container"></div>

<div id="label-container"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script type="text/javascript">

    // More API functions here:

    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

    // the link to your model provided by Teachable Machine export panel

    const URL = "./my_model/";

    let model, webcam, labelContainer, maxPredictions;

    // Load the image model and setup the webcam

    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        // load the model and metadata
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // Convenience function to setup a webcam
        const flip = false; // 후면 카메라 사용

        webcam = new tmImage.Webcam(200, 200, flip); // 가로, 세로, flip 설정
        await webcam.setup(); // 웹캠 접근 권한 요청
        await webcam.play();

        window.requestAnimationFrame(loop);

        // DOM에 요소 추가
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");

        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    // append elements to the DOM

    document.getElementById("webcam-container").appendChild(webcam.canvas);

    labelContainer = document.getElementById("label-container");

    for (let i = 0; i < maxPredictions; i++) { // and class labels

        labelContainer.appendChild(document.createElement("div"));

    }

    }

    async function loop() {

        webcam.update(); // update the webcam frame

        await predict();

        window.requestAnimationFrame(loop);

    }

    // run the webcam image through the image model

    async function predict() {

        // predict can take in an image, video or canvas html element

        const prediction = await model.predict(webcam.canvas);

        if (prediction[0].className == "감자탕뼈" && prediction[0].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "감자탕뼈"

        }

        else if (prediction[1].className == "게 껍데기" && prediction[1].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "게 껍데기"

        }

        else if (prediction[2].className == "견과류껍데기" && prediction[2].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "견과류껍데기"

        }

        else if (prediction[3].className == "계란 껍데기" && prediction[3].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "계란 껍데기"

        }

        else if (prediction[4].className == "고추창" && prediction[4].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "고추창"

        }

        else if (prediction[5].className == "닭뼈" && prediction[5].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "닭뼈"

        }

        else if (prediction[6].className == "마늘껍질" && prediction[6].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "마늘껍질"

        }
        else if (prediction[7].className == "씨" && prediction[7].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "씨"

        }

        else if (prediction[8].className == "새우껍질" && prediction[8].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "새우껍질"

        }

        else if (prediction[9].className == "수박껍질" && prediction[9].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "수박껍질"

        }
        else if (prediction[10].className == "쌈장" && prediction[10].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "쌈장"

        }
        else if (prediction[11].className == "양파껍질" && prediction[11].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "양파껍질"

        }
        else if (prediction[12].className == "옥수수껍질" && prediction[12].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "옥수수껍질"

        }
        else if (prediction[13].className == "옥수수 속대" && prediction[13].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "옥수수 속대"

        }

        else if (prediction[14].className == "원두 찌꺼기" && prediction[14].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "원두 찌꺼기"

        }
        else if (prediction[15].className == "조개껍데기" && prediction[15].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "조개껍데기"

        }
        else if (prediction[16].className == "족발뼈" && prediction[16].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "족발뼈"

        }

        else if (prediction[17].className == "티백" && prediction[17].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "티백"

        }
        else if (prediction[18].className == "파 뿌리" && prediction[18].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "파 뿌리"

        }

        else if (prediction[19].className == "파인애플 껍질" && prediction[19].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "파인애플 껍질"

        }
        else if (prediction[20].className == "홍합 껍데기" && prediction[20].probability.toFixed(2) == 100) {

            labelContainer.childNodes[0].innerHTML = "홍합 껍데기"

        }

        else {

            labelContainer.childNodes[0].innerHTML = "알수없음"

        }

        for (let i = 0; i < maxPredictions; i++) {

            const classPrediction =

                prediction[i].className + ": " + prediction[i].probability.toFixed(2);

            labelContainer.childNodes[i].innerHTML = classPrediction;

        }

    }
    async function predict() {
        // 예측 결과 가져오기
        const prediction = await model.predict(webcam.canvas);
        let maxProbability = 0;
        let maxIndex = 0;

        // 가장 높은 확률을 가진 항목 찾기
        for (let i = 0; i < maxPredictions; i++) {
            if (prediction[i].probability > maxProbability) {
                maxProbability = prediction[i].probability;
                maxIndex = i;
            }
        }

        // 가장 높은 확률을 가진 항목의 글자 색 변경
        for (let i = 0; i < maxPredictions; i++) {
            const labelElement = labelContainer.childNodes[i];
            if (i === maxIndex) {
                labelElement.style.color = "red"; // 가장 높은 확률 항목의 글자 색을 빨간색으로 변경
            } else {
                labelElement.style.color = "black"; // 다른 항목의 글자 색을 검은색으로 변경
            }

            const classPrediction = prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelElement.innerHTML = classPrediction;
        }
    }
</script>